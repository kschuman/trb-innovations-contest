---
title: "Metro Transit Bus Incident data"
author: "Matthew.Broughton@metrotransit.org"
date: '`r Sys.Date()`'
output:
  MetroTransitr::metro_html: default
  MetroTransitr::metro_presentation: default
  MetroTransitr::metro_report: default
---
<style type="text/css">
html {
  max-width: 10.5in;
  margin: 1.25in 0.75in;
  font-family: "Calibri", helvetica, sans-serif;
  font-size: 11pt;
}

body { width: 8.5in;
       max-width: 10.5in;
}
</style>

```{r setup, include=FALSE}
library(MetroTransitr)
library(data.table)
library(RODBC)
library(ggplot2)
library(DT)
# invalidate cache when the MetroTransitr version changes
knitr::opts_chunk$set(tidy = FALSE, cache.extra = packageVersion('MetroTransitr'))
options(htmltools.dir.version = FALSE)

# # allIncidents <- readRDS(file = "incidents.rds")
# allIncidents <- unique(allIncidents)
# incidents <- allIncidents[!is.na(updateLat) & !is.na(updateLon),
#                           .(Date, TimeVideo, updateLat, updateLon,  Description, Route, direction, Vehicle, Passenger_Count )]
# incidents <- unique(incidents)
# write.csv(incidents, file = "accidents.csv", row.names = FALSE)

incidents <- fread("accidents.csv")

```

# Introduction  
This document provides metadata to accompany data provided to the TRB APO10 Performance Measure Contest.

Data were requested in June, 2018.

# Data Sources

### Bus Incidents
Metro Transit operators submit a "Special Situation Report" or SSR for any unusual 
incident, and all accidents, while in operation. The SSRs are reviewed and coded by
safety specialists and used for a wide range of purposes. An SSR does not necessarily
indicate there was an accident, or suggest there would be a police report. A short
narrative is included in the SSR, while more detailed descriptions and records may 
be kept in personnel, police, or safety records. These records are not included in 
the data provided here. 

For some incidents, video from cameras inside the bus is requested and reviewed by 
Metro Transit safety personnel. The video can be used to update the exact time of the
incident, the narrative, and the exact location of the incident. When this is done, 
data are entered into additional fields described below. 

#### Metadata

The provided dataset is for SSR records with an exact time given by video review from `r incidents[, min(Date)]` and `r incidents[, max(Date)]`. 

There are `r scales::comma(nrow(incidents))` rows in the dataset with the following columns: 


```{r inctab, echo = F, eval = T, warning=F, message= F}
inctab <- data.table(Column_name = names(incidents),
                     Column_type = unlist(incidents[, lapply(.SD, class), .SDcols = names(incidents)]),
                     Column_desc = c( 'Date of incident', 
                                     'Updated time of incident, following video review by safety specialist, in HH:MM:SS',
                                     'Latitude in Decimal Degrees of the incident location as updated following video review by safety specialist. Should reflect the actual location of the incident.',
                                     'Longitude in Decimal Degrees of the SSR incident location as updated following video review by safety specialist. Should reflect the actual location of the incident.',
                                     "Type of incident",
                                     'Route number vehicle was operating, if applicable',
                                     'Description of route direction, if known',
                                     'Property tag of vehicle involved in incident',
                                     'Number of passengers on the bus at the time of the incident, if known'
                                     )
)
knitr::kable(inctab)
```


#### Sample data
```{r, echo = F, eval = T, warning=F, message= F}
knitr::kable(head(incidents))
```